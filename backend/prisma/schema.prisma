generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model categorias {
  id        BigInt      @id @default(autoincrement())
  nombre    String      @unique(map: "uq_categorias_nombre") @db.VarChar(80)
  activo    Boolean     @default(true)
  productos productos[]

  @@index([nombre], map: "ix_categorias_nombre")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model clientes {
  id             BigInt           @id @default(autoincrement())
  nombre         String           @db.VarChar(80)
  apellido       String           @db.VarChar(80)
  telefono       String?          @db.VarChar(30)
  correo         String?          @db.VarChar(120)
  tipo           String           @db.VarChar(20)
  activo         Boolean          @default(true)
  fecha_alta     DateTime         @default(now()) @db.Timestamptz(6)
  movimientos_cc movimientos_cc[]
  pagos_cliente  pagos_cliente[]
  ventas         ventas[]

  @@index([apellido], map: "ix_clientes_apellido")
  @@index([correo], map: "ix_clientes_correo")
  @@index([nombre], map: "ix_clientes_nombre")
  @@index([tipo], map: "ix_clientes_tipo")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model detalle_oc {
  id             BigInt         @id @default(autoincrement())
  orden_id       BigInt
  producto_id    BigInt
  cantidad       Decimal        @db.Decimal(12, 3)
  precio_compra  Decimal        @db.Decimal(12, 2)
  subtotal       Decimal        @db.Decimal(12, 2)
  ordenes_compra ordenes_compra @relation(fields: [orden_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  productos      productos      @relation(fields: [producto_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([orden_id], map: "ix_doc_orden")
  @@index([producto_id], map: "ix_doc_producto")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model detalle_recepcion {
  id            BigInt      @id @default(autoincrement())
  recepcion_id  BigInt
  producto_id   BigInt
  cant_pedida   Decimal     @db.Decimal(12, 3)
  cant_recibida Decimal     @db.Decimal(12, 3)
  precio        Decimal     @db.Decimal(12, 2)
  subtotal      Decimal     @db.Decimal(12, 2)
  productos     productos   @relation(fields: [producto_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  recepciones   recepciones @relation(fields: [recepcion_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([producto_id], map: "ix_drec_producto")
  @@index([recepcion_id], map: "ix_drec_recepcion")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model detalle_venta {
  id              BigInt    @id @default(autoincrement())
  venta_id        BigInt
  producto_id     BigInt
  cantidad        Decimal   @db.Decimal(12, 3)
  precio_unitario Decimal   @db.Decimal(12, 2)
  subtotal        Decimal   @db.Decimal(12, 2)
  productos       productos @relation(fields: [producto_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  ventas          ventas    @relation(fields: [venta_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([producto_id], map: "ix_dv_producto")
  @@index([venta_id], map: "ix_dv_venta")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model movimientos_cc {
  id               BigInt   @id @default(autoincrement())
  cliente_id       BigInt
  fecha            DateTime @default(now()) @db.Timestamptz(6)
  tipo             String   @db.VarChar(12)
  nro_comprobante  String?  @db.VarChar(30)
  monto            Decimal  @db.Decimal(12, 2)
  saldo_resultante Decimal  @db.Decimal(12, 2)
  observacion      String?  @db.VarChar(200)
  clientes         clientes @relation(fields: [cliente_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([cliente_id], map: "ix_movcc_cliente")
  @@index([fecha], map: "ix_movcc_fecha")
  @@index([tipo], map: "ix_movcc_tipo")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model movimientos_stock {
  id               BigInt    @id @default(autoincrement())
  producto_id      BigInt
  fecha_hora       DateTime  @default(now()) @db.Timestamptz(6)
  tipo_operacion   String    @db.VarChar(8)
  motivo           String    @db.VarChar(15)
  cantidad         Decimal   @db.Decimal(12, 3)
  observaciones    String?   @db.VarChar(250)
  doc_adjunto_ruta String?   @db.VarChar(260)
  usuario_id       BigInt
  productos        productos @relation(fields: [producto_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user         User  @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([fecha_hora], map: "ix_mstock_fecha")
  @@index([producto_id], map: "ix_mstock_producto")
  @@index([tipo_operacion], map: "ix_mstock_tipo")
  @@index([usuario_id], map: "ix_mstock_usuario")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model ordenes_compra {
  id            BigInt        @id @default(autoincrement())
  proveedor_id  BigInt
  fecha         DateTime      @default(now()) @db.Timestamptz(6)
  nro_orden     String        @unique(map: "uq_oc_nro") @db.VarChar(20)
  observaciones String?       @db.VarChar(200)
  total         Decimal       @default(0) @db.Decimal(12, 2)
  estado        String        @default("Pendiente") @db.VarChar(12)
  usuario_id    BigInt
  detalle_oc    detalle_oc[]
  proveedores   proveedores   @relation(fields: [proveedor_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user      User      @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  recepciones   recepciones[]

  @@index([estado], map: "ix_oc_estado")
  @@index([fecha], map: "ix_oc_fecha")
  @@index([proveedor_id], map: "ix_oc_proveedor")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model pagos_cliente {
  id          BigInt   @id @default(autoincrement())
  cliente_id  BigInt
  fecha       DateTime @default(now()) @db.Timestamptz(6)
  monto       Decimal  @db.Decimal(12, 2)
  forma_pago  String   @db.VarChar(15)
  observacion String?  @db.VarChar(200)
  usuario_id  BigInt
  clientes    clientes @relation(fields: [cliente_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user        User     @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([cliente_id], map: "ix_pagos_cliente")
  @@index([fecha], map: "ix_pagos_fecha")
  @@index([forma_pago], map: "ix_pagos_forma")
  @@index([usuario_id], map: "ix_pagos_usuario")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model precios {
  id                  BigInt    @id @default(autoincrement())
  producto_id         BigInt
  precio_minorista    Decimal   @db.Decimal(12, 2)
  precio_mayorista    Decimal   @db.Decimal(12, 2)
  precio_supermayorista Decimal @default(0) @db.Decimal(12, 2)
  ultima_modificacion DateTime  @default(now()) @db.Timestamptz(6)
  usuario_id          BigInt
  productos           productos @relation(fields: [producto_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user            User  @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([producto_id], map: "ix_precios_producto")
  @@index([ultima_modificacion], map: "ix_precios_ult")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model productos {
  id                BigInt              @id @default(autoincrement())
  nombre            String              @db.VarChar(120)
  categoria_id      BigInt
  unidad_id         BigInt
  costo             Decimal             @db.Decimal(12, 4)
  precio_lista      Decimal             @db.Decimal(12, 2)
  iva_porcentaje    Decimal             @db.Decimal(4, 1)
  stock_actual      Decimal             @default(0) @db.Decimal(12, 3)
  stock_minimo      Decimal             @default(0) @db.Decimal(12, 3)
  activo            Boolean             @default(true)
  descripcion       String?             @db.VarChar(200)
  ultima_modif      DateTime            @default(now()) @db.Timestamptz(6)
  detalle_oc        detalle_oc[]
  detalle_recepcion detalle_recepcion[]
  detalle_venta     detalle_venta[]
  movimientos_stock movimientos_stock[]
  precios           precios[]
  categorias        categorias          @relation(fields: [categoria_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  unidades          unidades            @relation(fields: [unidad_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([activo], map: "ix_productos_activo")
  @@index([categoria_id], map: "ix_productos_categoria")
  @@index([nombre], map: "ix_productos_nombre")
  @@index([unidad_id], map: "ix_productos_unidad")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model proveedores {
  id             BigInt           @id @default(autoincrement())
  nombre         String           @db.VarChar(120)
  telefono       String?          @db.VarChar(30)
  correo         String?          @db.VarChar(120)
  activo         Boolean          @default(true)
  fecha_alta     DateTime         @default(now()) @db.Timestamptz(6)
  ordenes_compra ordenes_compra[]

  @@index([nombre], map: "ix_prov_nombre")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model recepciones {
  id                BigInt              @id @default(autoincrement())
  orden_id          BigInt
  fecha             DateTime            @default(now()) @db.Timestamptz(6)
  estado            String              @db.VarChar(12)
  observaciones     String?             @db.VarChar(200)
  usuario_id        BigInt
  detalle_recepcion detalle_recepcion[]
  ordenes_compra    ordenes_compra      @relation(fields: [orden_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user          User            @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([estado], map: "ix_rec_estado")
  @@index([fecha], map: "ix_rec_fecha")
  @@index([orden_id], map: "ix_rec_orden")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model recuperos_credenciales {
  id            BigInt    @id @default(autoincrement())
  usuario_id    BigInt
  token         String    @unique(map: "uq_recupero_token") @db.VarChar(64)
  solicitado_en DateTime  @default(now()) @db.Timestamptz(6)
  utilizado_en  DateTime? @db.Timestamptz(6)
  vigente       Boolean   @default(true)
  user      User  @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([usuario_id], map: "ix_recupero_usuario")
}

model unidades {
  id        BigInt      @id @default(autoincrement())
  nombre    String      @unique(map: "uq_unidades_nombre") @db.VarChar(20)
  productos productos[]

  @@index([nombre], map: "ix_unidades_nombre")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model User {
  id                     BigInt                   @id @default(autoincrement())
  email                  String                   @unique(map: "uq_usuarios_correo") @db.VarChar(100) @map("correo")
  username               String                   @unique(map: "uq_usuarios_usuario") @db.VarChar(60) @map("usuario")
  password               String                   @db.VarChar(255) @map("contrasena_hash")
  isActive               Boolean                  @default(true) @map("activo")
  createdAt              DateTime                 @default(now()) @db.Timestamptz(6) @map("fecha_alta")
  lastLogin              DateTime?                @db.Timestamptz(6) @map("ultimo_acceso")
  rememberToken          String?                  @db.VarChar(200) @map("recordar_token")
  movimientos_stock      movimientos_stock[]
  ordenes_compra         ordenes_compra[]
  pagos_cliente          pagos_cliente[]
  precios                precios[]
  recepciones            recepciones[]
  recuperos_credenciales recuperos_credenciales[]
  ventas                 ventas[]

  @@index([lastLogin], map: "ix_usuarios_ultimo_acceso")
  @@map("usuarios")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model ventas {
  id            BigInt          @id @default(autoincrement())
  fecha         DateTime        @default(now()) @db.Timestamptz(6)
  cliente_id    BigInt
  tipo_venta    String          @db.VarChar(20)
  descuento     Decimal         @default(0) @db.Decimal(12, 2)
  total         Decimal         @db.Decimal(12, 2)
  forma_pago    String          @db.VarChar(12)
  usuario_id    BigInt
  detalle_venta detalle_venta[]
  clientes      clientes        @relation(fields: [cliente_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user          User            @relation(fields: [usuario_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([cliente_id], map: "ix_ventas_cliente")
  @@index([fecha], map: "ix_ventas_fecha")
  @@index([forma_pago], map: "ix_ventas_pago")
  @@index([tipo_venta], map: "ix_ventas_tipo")
  @@index([total], map: "ix_ventas_total")
}
